{"version":3,"sources":["../src/engine/MapEngine.ts","../src/providers/google/GoogleMapEngine.ts","../src/utils/geo.ts","../src/engine/controllers/LiveMotionController.ts","../src/engine/controllers/TripReplayController.ts"],"sourcesContent":["import type { MapEngineOptions, ThemeName, VehicleLike } from './types.js';\n\n/**\n * Abstract base class for Map Engines (e.g., Google Maps, Leaflet, Mapbox).\n * Defines the contract for interacting with the map.\n */\nexport abstract class MapEngine {\n    protected options: MapEngineOptions;\n\n    constructor(options: MapEngineOptions) {\n        this.options = options;\n    }\n\n    /**\n     * Initializes and mounts the map to the specified DOM element.\n     * @param element The container ID or HTMLElement.\n     */\n    abstract mount(element: string | HTMLElement): Promise<any>;\n\n    /**\n     * Adds a marker for a vehicle.\n     */\n    abstract addVehicleMarker(vehicle: VehicleLike): void;\n\n    /**\n     * Updates an existing vehicle marker (position, icon, content).\n     */\n    abstract updateVehicleMarker(vehicle: VehicleLike): void;\n\n    /**\n     * Removes a vehicle marker by ID.\n     */\n    abstract removeMarker(id: string | number): void;\n\n    /**\n     * Removes all markers from the map.\n     */\n    abstract clearAllMarkers(): void;\n\n    /**\n     * Centers the map to fit the given vehicles.\n     */\n    abstract centerOnVehicles(vehicles: VehicleLike[]): void;\n\n    /**\n     * Centers the map on a specific vehicle/location.\n     */\n    abstract setCenter(lat: number, lng: number): void;\n\n    /**\n     * Sets the zoom level.\n     */\n    abstract setZoom(zoom: number): void;\n\n    /**\n     * Draws a polyline for a trip/route.\n     */\n    abstract drawTripPolyline(coordinates: any[]): void;\n\n    /**\n     * Clears the current trip polyline.\n     */\n    abstract clearTripPolyline(): void;\n\n    /**\n     * Animates a vehicle along a path.\n     */\n    abstract animateTrip(coordinates: any[], totalDuration?: number, onFinish?: () => void): void;\n\n    /**\n     * Stops any active trip animation.\n     */\n    abstract stopTripAnimation(): void;\n\n    /**\n     * Updates the map theme.\n     */\n    setTheme(theme: ThemeName): void {\n        this.options.theme = theme;\n        this.onThemeChange(theme);\n    }\n\n    /**\n     * Internal method to handle theme changes in the specific implementation.\n     */\n    protected abstract onThemeChange(theme: ThemeName): void;\n\n    /**\n     * Starts the live tracking animation loop.\n     */\n    abstract startLive(): void;\n\n    /**\n     * Stops the live tracking animation loop to save resources.\n     */\n    abstract stopLive(): void;\n\n    /**\n     * Cleans up resources.\n     */\n    abstract dispose(): void;\n}\n","/// <reference types=\"@types/google.maps\" />\nimport { setOptions, importLibrary } from '@googlemaps/js-api-loader';\nimport { MapEngine } from '../../engine/MapEngine.js';\nimport type { MapEngineOptions, ThemeName, VehicleLike, IconConfig, LiveMotionInput } from '../../engine/types.js';\nimport { LiveMotionController } from '../../engine/controllers/LiveMotionController.js';\nimport { TripReplayController } from '../../engine/controllers/TripReplayController.js';\nimport type { MarkerAdapter } from '../../engine/interfaces/MarkerAdapter.js';\n\n\nconst DEFAULT_SVG_PATH = `M3780 6510 c-376 -17 -782 -56 -1110 -106 -334 -51 -726 -141 -887 -204 -282 -108 -642 -475 -952 -968 -39 -62 -120 -202 -180 -310 -59 -108 -159 -273 -220 -367 -124 -187 -189 -312 -220 -423 -27 -97 -45 -258 -38 -346 l5 -70 -53 -55 c-32 -34 -59 -74 -68 -101 -59 -178 -68 -407 -23 -610 32 -144 45 -175 47 -115 2 51 6 30 14 -70 7 -74 8 -77 21 -55 12 22 13 9 14 -110 0 -150 20 -364 45 -484 39 -188 81 -269 165 -316 42 -23 56 -25 216 -28 193 -4 224 3 266 59 29 39 45 83 54 155 9 76 -9 73 -40 -6 -15 -38 -40 -83 -56 -100 -30 -32 -59 -37 -154 -24 -43 6 -45 8 -31 24 35 38 80 223 107 435 18 143 16 626 -4 728 -8 42 -11 74 -7 70 9 -10 41 -122 95 -338 44 -176 54 -191 29 -45 -50 301 -111 512 -200 695 -80 166 -173 241 -263 215 -150 -43 -238 -219 -262 -527 -8 -103 -9 -101 -5 47 4 150 18 252 49 353 10 34 32 67 70 107 31 32 56 67 56 77 1 10 3 77 5 148 7 241 57 372 255 665 66 99 163 257 216 352 232 415 422 677 669 923 146 146 284 249 395 296 93 39 365 108 604 154 953 179 2196 201 3391 60 867 -103 1370 -240 1820 -494 435 -246 716 -470 1539 -1225 l338 -311 127 -43 c182 -63 367 -120 691 -212 530 -151 700 -206 970 -312 297 -117 588 -279 780 -435 93 -75 272 -258 294 -301 27 -52 44 -135 62 -295 9 -84 25 -185 35 -226 10 -41 19 -76 19 -78 0 -1 -17 -3 -38 -3 -20 0 -116 -9 -212 -20 -194 -22 -372 -26 -452 -9 -72 15 -172 64 -198 96 -13 17 -18 34 -14 47 39 131 173 240 524 425 194 103 205 110 192 123 -25 25 -283 -48 -448 -127 -258 -122 -398 -263 -411 -416 -12 -124 81 -218 272 -275 158 -48 521 3 749 104 57 25 58 25 69 6 6 -10 34 -44 63 -74 63 -66 71 -85 84 -198 11 -98 3 -242 -12 -202 -8 22 -10 23 -116 18 -193 -10 -328 -78 -387 -196 -1 -1 -21 16 -44 38 -57 54 -94 72 -166 77 -148 11 -2694 -147 -3092 -192 -73 -8 -135 -15 -138 -15 -3 0 -3 -5 0 -10 8 -13 417 -13 860 0 525 16 1247 40 1485 50 781 32 879 34 915 17 77 -37 122 -144 112 -271 -10 -134 -98 -354 -150 -376 -12 -5 -141 -19 -287 -30 -927 -73 -2531 -209 -3288 -280 -286 -27 -280 -27 -329 15 -23 19 -51 56 -63 81 -59 121 20 311 214 513 132 137 306 236 469 266 63 12 44 28 -26 21 -215 -22 -399 -124 -578 -322 l-57 -62 5 78 c6 87 -9 148 -53 212 -39 56 -69 70 -174 85 -138 19 -881 30 -940 13 -56 -15 -111 -71 -135 -137 -25 -71 -31 -240 -11 -326 28 -119 93 -215 160 -236 44 -14 489 -43 691 -45 191 -1 207 3 288 74 l43 38 -7 -51 c-14 -103 20 -198 97 -272 87 -85 33 -83 860 -26 689 49 2599 194 2971 226 94 8 184 20 200 25 72 28 141 126 193 277 l32 92 42 -21 c47 -24 165 -30 204 -9 12 6 22 10 22 7 0 -15 -84 -195 -114 -245 -39 -63 -92 -116 -133 -132 -25 -9 -837 -148 -1278 -218 -1233 -196 -2118 -289 -2967 -310 -828 -21 -1561 39 -2186 179 -204 45 -229 73 -435 485 -175 351 -170 338 -358 974 -108 366 -215 572 -393 759 -198 207 -387 311 -545 300 -182 -13 -313 -148 -411 -423 -73 -207 -132 -557 -129 -772 l1 -88 23 170 c27 203 48 316 81 450 105 418 272 626 483 601 191 -23 472 -262 619 -529 90 -162 134 -290 267 -767 88 -316 142 -463 224 -615 21 -38 62 -122 91 -185 109 -240 191 -351 299 -409 62 -33 203 -68 466 -116 929 -171 2026 -184 3394 -39 l244 26 51 -50 c60 -59 123 -93 226 -121 120 -33 217 -41 525 -48 403 -8 471 5 580 108 67 64 98 123 121 238 l18 89 491 81 c270 45 506 86 524 91 111 32 189 116 281 305 224 458 316 849 266 1133 -17 99 -40 155 -76 187 -49 43 -100 119 -115 168 -9 29 -24 129 -35 222 -35 302 -57 351 -240 536 -191 192 -375 323 -655 464 -329 167 -601 261 -1410 490 -497 141 -668 199 -719 244 -22 20 -155 142 -295 271 -462 427 -712 646 -916 805 -399 310 -741 510 -1105 647 -451 169 -1184 290 -2127 353 -274 18 -1042 27 -1313 15z m-3340 -2935 c27 -14 78 -71 113 -127 26 -42 20 -45 -15 -11 -65 63 -149 72 -216 23 -68 -49 -114 -138 -147 -285 -16 -75 -19 -34 -4 72 33 242 153 388 269 328z m22 -262 c45 -49 92 -209 117 -398 38 -280 29 -858 -15 -1008 -4 -12 -12 -16 -21 -13 -12 5 -14 1 -10 -14 5 -20 2 -21 -41 -14 -60 8 -111 32 -134 64 -21 30 -53 154 -68 265 -6 44 -13 177 -17 296 -11 391 36 737 113 828 27 33 42 32 76 -6z m12102 -1601 c-20 -56 -52 -168 -73 -248 l-37 -146 -67 -4 c-77 -5 -100 4 -127 49 -26 42 -26 170 -1 242 23 67 84 112 226 169 61 24 111 43 112 42 1 -1 -14 -48 -33 -104z m-4758 -188 c33 -22 70 -87 83 -146 28 -125 -82 -349 -202 -410 -47 -24 -19 -25 -521 16 -288 23 -300 25 -317 47 -49 66 -73 245 -45 341 9 31 21 60 27 64 7 4 100 13 208 20 400 27 712 61 730 79 7 7 10 6 37 -11z m3322 -1121 c-27 -49 -60 -99 -71 -111 -28 -31 -92 -68 -139 -80 -56 -15 -832 3 -930 22 -82 15 -168 44 -168 56 0 4 64 15 143 24 200 25 723 100 972 140 116 18 218 34 227 35 12 1 4 -20 -34 -86z`;\n\nfunction buildSvgSymbol(bearing: number): google.maps.Symbol {\n    return {\n        path: DEFAULT_SVG_PATH,\n        rotation: bearing,\n        scale: 0.02,\n        fillOpacity: 1,\n        strokeWeight: 0,\n    };\n}\n\nexport class GoogleMapEngine extends MapEngine {\n    private map: google.maps.Map | null = null;\n    private googleApi: typeof google | null = null;\n    private markers = new Map<string | number, { marker: google.maps.Marker; infoWindow: google.maps.InfoWindow }>();\n\n    // Controllers\n    private liveController: LiveMotionController;\n    private tripController: TripReplayController | null = null;\n    private markerAdapter: MarkerAdapter;\n\n    constructor(options: MapEngineOptions) {\n        super(options);\n\n        const lastRotation = new Map<string | number, number>();\n\n        this.markerAdapter = {\n            setMarkerPosition: (id, lat, lng) => {\n                const m = this.markers.get(id)?.marker;\n                if (m && this.googleApi) {\n                    m.setPosition(new this.googleApi.maps.LatLng(lat, lng));\n                }\n            },\n            setMarkerRotation: (id, bearing) => {\n                const m = this.markers.get(id)?.marker;\n                if (!m) return;\n\n                // If PNG, don't rotate\n                const icon: any = m.getIcon();\n                if (icon?.url) return;\n\n                // Basic throttle\n                const prev = lastRotation.get(id);\n                if (prev !== undefined && Math.abs(prev - bearing) < 2) return;\n                lastRotation.set(id, bearing);\n\n                m.setIcon(buildSvgSymbol(bearing));\n            }\n        };\n\n        this.liveController = new LiveMotionController(this.markerAdapter, this.options.liveMotionPolicy);\n        this.liveController.start();\n    }\n\n    async mount(element: string | HTMLElement): Promise<google.maps.Map> {\n        const apiKey = this.options.apiKey || (import.meta as any).env.VITE_GOOGLE_MAPS_API_KEY;\n        if (!apiKey) {\n            throw new Error('Google Maps API Key is required');\n        }\n\n        setOptions({\n            key: apiKey,\n            v: 'weekly',\n            libraries: ['places']\n        });\n\n        await importLibrary('maps');\n        await importLibrary('marker');\n\n        this.googleApi = google;\n\n        const initialTheme: ThemeName = this.options.theme || 'modern';\n        const styles = this.getStylesForTheme(initialTheme);\n        const backgroundColor = this.getBackgroundColorForTheme(initialTheme);\n\n        const mapOptions: google.maps.MapOptions = {\n            backgroundColor: this.options.backgroundColor || backgroundColor,\n            center: this.options.center || { lat: 19.4326, lng: -99.1332 },\n            zoom: this.options.zoom || 13,\n            fullscreenControl: true,\n            streetViewControl: false,\n            mapTypeControl: false,\n            zoomControl: true,\n            styles: (styles as any) || undefined,\n            disableDefaultUI: true,\n            ...this.options.mapOptions\n        };\n\n        const el = typeof element === 'string' ? document.getElementById(element) : element;\n        if (!el) throw new Error('Map container element not found');\n\n        this.map = new this.googleApi!.maps.Map(el as HTMLElement, mapOptions);\n\n        if (mapOptions.backgroundColor) {\n            this.map.getDiv().style.backgroundColor = mapOptions.backgroundColor;\n        }\n\n        // Initialize TripController now that map is ready\n        this.tripController = new TripReplayController(this.map, this.googleApi);\n\n        return this.map;\n    }\n\n    private getBackgroundColorForTheme(theme: ThemeName): string {\n        switch (theme) {\n            case 'modern': return '#0b1524';\n            case 'dark': return '#0B1524';\n            case 'light': default: return '#0F1115';\n        }\n    }\n\n    private getStylesForTheme(theme: ThemeName): google.maps.MapTypeStyle[] | null {\n        if (this.options.styles && this.options.styles[theme]) {\n            return this.options.styles[theme];\n        }\n        return null;\n    }\n\n    protected onThemeChange(theme: ThemeName): void {\n        console.log('[GoogleMapEngine] onThemeChange called with:', theme);\n        if (this.map) {\n            const styles = this.getStylesForTheme(theme);\n            const backgroundColor = this.getBackgroundColorForTheme(theme);\n            const styleCount = styles ? `${styles.length} rules` : 'Default (null)';\n            console.log(`[GoogleMapEngine] Applying styles: ${styleCount}, bg: ${backgroundColor}`);\n            this.map.setOptions({ styles, backgroundColor });\n            this.map.getDiv().style.backgroundColor = backgroundColor;\n        } else {\n            console.warn('[GoogleMapEngine] Map not initialized, skipping theme update');\n        }\n    }\n\n    private adaptToInput(vehicle: VehicleLike, lat: number, lng: number, id: string | number): LiveMotionInput {\n        const motion: LiveMotionInput['motion'] = {};\n\n        if (vehicle.alert === 'Turn On') motion.ignition = 'on';\n        else if (vehicle.alert === 'Turn Off') motion.ignition = 'off';\n\n        if (vehicle.engine_status !== undefined) {\n            const status = String(vehicle.engine_status).toLowerCase();\n            motion.moving = status === '1' || status === 'true' || status === 'on';\n        }\n\n        const input: LiveMotionInput = {\n            id,\n            lat,\n            lng,\n            speedKmh: Number(vehicle.speed || 0),\n            bearing: Number(vehicle.course || 0),\n            motion\n        };\n\n        if (vehicle.ts) {\n            input.timestamp = Number(vehicle.ts);\n        } else if (vehicle.timestamp) {\n            input.timestamp = Number(vehicle.timestamp);\n        }\n\n        return input;\n    }\n\n    addVehicleMarker(vehicle: VehicleLike): void {\n        if (!this.map || !this.googleApi) return;\n\n        const lat = Number(vehicle.lat || vehicle.latitude);\n        const lng = Number(vehicle.lng || vehicle.longitude);\n        const id = vehicle.id || vehicle.device_id || vehicle.deviceId;\n\n        if (isNaN(lat) || isNaN(lng) || !id) {\n            console.warn('Invalid coords or ID for vehicle', vehicle);\n            return;\n        }\n\n        const position = { lat, lng };\n\n        let iconConfig: IconConfig = { url: '' };\n        if (this.options.iconResolver) {\n            iconConfig = this.options.iconResolver(vehicle);\n        }\n\n        const markerOptions: google.maps.MarkerOptions = {\n            position,\n            map: this.map,\n            title: String(vehicle.device_id || id),\n        };\n\n        if (iconConfig.url) {\n            markerOptions.icon = {\n                url: iconConfig.url,\n                scaledSize: iconConfig.size ? new this.googleApi!.maps.Size(iconConfig.size[0], iconConfig.size[1]) : null,\n                anchor: iconConfig.anchor ? new this.googleApi!.maps.Point(iconConfig.anchor[0], iconConfig.anchor[1]) : null\n            };\n        } else {\n            markerOptions.icon = buildSvgSymbol(Number(vehicle.course || 0));\n        }\n\n        const marker = new this.googleApi.maps.Marker(markerOptions);\n\n        let content = '';\n        if (this.options.infoWindowRenderer) {\n            content = this.options.infoWindowRenderer(vehicle);\n        }\n        const infoWindow = new this.googleApi.maps.InfoWindow({ content });\n\n        marker.addListener('click', () => {\n            infoWindow.open(this.map, marker);\n        });\n\n        this.markers.set(id, { marker, infoWindow });\n\n        this.liveController.update(this.adaptToInput(vehicle, lat, lng, id));\n    }\n\n    updateVehicleMarker(vehicle: VehicleLike): void {\n        const id = vehicle.id || vehicle.device_id || vehicle.deviceId;\n        const existing = this.markers.get(id);\n\n        if (!existing) {\n            this.addVehicleMarker(vehicle);\n            return;\n        }\n\n        const lat = Number(vehicle.lat || vehicle.latitude);\n        const lng = Number(vehicle.lng || vehicle.longitude);\n\n        if (!isNaN(lat) && !isNaN(lng)) {\n            if (this.options.infoWindowRenderer) {\n                existing.infoWindow.setContent(this.options.infoWindowRenderer(vehicle));\n            }\n\n            if (this.options.iconResolver) {\n                const iconConfig = this.options.iconResolver(vehicle);\n                if (iconConfig.url) {\n                    existing.marker.setIcon({\n                        url: iconConfig.url,\n                        scaledSize: iconConfig.size ? new this.googleApi!.maps.Size(iconConfig.size[0], iconConfig.size[1]) : null,\n                        anchor: iconConfig.anchor ? new this.googleApi!.maps.Point(iconConfig.anchor[0], iconConfig.anchor[1]) : null\n                    });\n                }\n            }\n\n            this.liveController.update(this.adaptToInput(vehicle, lat, lng, id));\n        }\n    }\n\n    removeMarker(id: string | number): void {\n        const data = this.markers.get(id);\n        if (data) {\n            data.marker.setMap(null);\n            this.markers.delete(id);\n        }\n        this.liveController.remove(id);\n    }\n\n    clearAllMarkers(): void {\n        this.markers.forEach(data => data.marker.setMap(null));\n        this.markers.clear();\n\n        // Clear controller state\n        this.liveController.clear();\n    }\n\n    startLive(): void {\n        this.liveController.start();\n    }\n\n    stopLive(): void {\n        this.liveController.stop();\n    }\n\n    centerOnVehicles(vehicles: VehicleLike[]): void {\n        if (!this.map || !this.googleApi || !vehicles.length) return;\n        const bounds = new this.googleApi.maps.LatLngBounds();\n        let hasValid = false;\n        vehicles.forEach(v => {\n            const lat = Number(v.lat || v.latitude);\n            const lng = Number(v.lng || v.longitude);\n            if (!isNaN(lat) && !isNaN(lng)) {\n                bounds.extend({ lat, lng });\n                hasValid = true;\n            }\n        });\n        if (hasValid) {\n            this.map.fitBounds(bounds);\n        }\n    }\n\n    setCenter(lat: number, lng: number): void {\n        if (this.map) {\n            this.map.setCenter({ lat, lng });\n        }\n    }\n\n    setZoom(zoom: number): void {\n        if (this.map) {\n            this.map.setZoom(zoom);\n        }\n    }\n\n    // ==========================================\n    // TRIP POLYLINE & ANIMATION DELEGATION\n    // ==========================================\n\n    drawTripPolyline(coordinates: any[]): void {\n        if (this.tripController) {\n            this.tripController.drawPolyline(coordinates);\n        }\n    }\n\n    clearTripPolyline(): void {\n        if (this.tripController) {\n            this.tripController.clearPolyline();\n        }\n    }\n\n    stopTripAnimation(): void {\n        if (this.tripController) {\n            this.tripController.stop();\n        }\n    }\n\n    animateTrip(coordinates: any[], totalDuration = 10000, onFinish?: () => void): void {\n        if (this.tripController) {\n            this.tripController.load(coordinates);\n            this.tripController.play({ duration: totalDuration }, onFinish);\n        }\n    }\n\n    dispose(): void {\n        this.liveController.stop();\n        if (this.tripController) {\n            this.tripController.stop();\n            this.tripController.clearPolyline();\n        }\n        this.clearAllMarkers();\n        this.map = null;\n    }\n}\n","export interface GeoPoint {\n    lat: number;\n    lng: number; // standardized to lng but supporting lon for input if needed\n}\n\nexport interface LatLng {\n    lat: number;\n    lng: number;\n}\n\n/**\n * Calculates the distance between two points in meters using the Haversine formula.\n */\nexport function haversineDistance(coords1: { lat: number; lng?: number; lon?: number }, coords2: { lat: number; lng?: number; lon?: number }): number {\n    const R = 6371e3; // metres\n    const lat1 = coords1.lat;\n    const lon1 = coords1.lng ?? coords1.lon ?? 0;\n    const lat2 = coords2.lat;\n    const lon2 = coords2.lng ?? coords2.lon ?? 0;\n\n    const φ1 = (lat1 * Math.PI) / 180; // φ, λ in radians\n    const φ2 = (lat2 * Math.PI) / 180;\n    const Δφ = ((lat2 - lat1) * Math.PI) / 180;\n    const Δλ = ((lon2 - lon1) * Math.PI) / 180;\n\n    const a =\n        Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +\n        Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n    return R * c; // in metres\n}\n\n/**\n * Computes the bearing (heading) from one point to another in degrees (0-360).\n */\nexport function computeBearing(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const φ1 = (lat1 * Math.PI) / 180;\n    const φ2 = (lat2 * Math.PI) / 180;\n    const Δλ = ((lon2 - lon1) * Math.PI) / 180;\n\n    const y = Math.sin(Δλ) * Math.cos(φ2);\n    const x = Math.cos(φ1) * Math.sin(φ2) - Math.sin(φ1) * Math.cos(φ2) * Math.cos(Δλ);\n\n    return ((Math.atan2(y, x) * 180) / Math.PI + 360) % 360;\n}\n\n/**\n * Extrapolates a new position based on start point, speed, bearing and time delta.\n */\nexport function extrapolatePosition(lat: number, lon: number, speedMps: number, bearingDeg: number, deltaSeconds: number): { lat: number; lon: number } {\n    const R = 6378137;\n    const dist = speedMps * deltaSeconds;\n    const δ = dist / R;\n    const θ = (bearingDeg * Math.PI) / 180;\n\n    const φ1 = (lat * Math.PI) / 180;\n    const λ1 = (lon * Math.PI) / 180;\n\n    const φ2 = Math.asin(Math.sin(φ1) * Math.cos(δ) + Math.cos(φ1) * Math.sin(δ) * Math.cos(θ));\n\n    const λ2 =\n        λ1 +\n        Math.atan2(\n            Math.sin(θ) * Math.sin(δ) * Math.cos(φ1),\n            Math.cos(δ) - Math.sin(φ1) * Math.sin(φ2)\n        );\n\n    return {\n        lat: (φ2 * 180) / Math.PI,\n        lon: (λ2 * 180) / Math.PI\n    };\n}\n\n/**\n * Linearly interpolates between two positions.\n */\nexport function lerpPosition(pos1: { lat: number; lon: number }, pos2: { lat: number; lon: number }, t: number): { lat: number; lon: number } {\n    return {\n        lat: pos1.lat + (pos2.lat - pos1.lat) * t,\n        lon: pos1.lon + (pos2.lon - pos1.lon) * t\n    };\n}\n\n/**\n * Linearly interpolates between two angles (in degrees), taking the shortest path.\n */\nexport function lerpAngle(start: number, end: number, t: number): number {\n    const diff = ((end - start + 180) % 360 + 360) % 360 - 180;\n    return (start + diff * t + 360) % 360;\n}\n\n/**\n * Clamps a value between a minimum and maximum.\n */\nexport function clamp(value: number, min: number, max: number): number {\n    return Math.max(min, Math.min(max, value));\n}\n","import { haversineDistance, computeBearing, extrapolatePosition, lerpPosition, lerpAngle } from '../../utils/geo.js';\nimport type { LiveMotionInput, LiveMotionPolicy } from '../types.js';\nimport type { MarkerAdapter } from '../interfaces/MarkerAdapter.js';\n\ninterface LiveUnitState {\n    // Última posición REAL reportada por el backend\n    realPosition: {\n        lat: number;\n        lon: number;\n        ts: number;\n        speed: number;\n        bearing: number;\n    };\n\n    // Posición previa para cálculos de bearing si falta\n    prevPosition: {\n        lat: number;\n        lon: number;\n        ts: number;\n    } | null;\n\n    // Estado VISUAL (Interpolado/Extrapolado)\n    virtualPosition: {\n        lat: number;\n        lon: number;\n        bearing: number; // visual bearing\n    };\n\n    // Target físico para suavizado de rotación\n    targetBearing: number;\n\n    isStopped: boolean;\n}\n\nconst DEFAULT_POLICY: LiveMotionPolicy = {\n    fullConfidenceMs: 5000,\n    decayMs: 10000,\n    maxStaleMs: 15 * 60 * 1000\n};\n\nexport class LiveMotionController {\n    private liveVehicles = new Map<string | number, LiveUnitState>();\n    private liveAnimationFrameId: number | null = null;\n    private lastLiveFrameTime = 0;\n    private policy: LiveMotionPolicy;\n\n    constructor(\n        private markerAdapter: MarkerAdapter,\n        policy?: Partial<LiveMotionPolicy>\n    ) {\n        this.policy = { ...DEFAULT_POLICY, ...policy };\n    }\n\n    /**\n     * Updates the state of a vehicle/unit based on standardized input.\n     * Decoupled from backend models.\n     */\n    update(input: LiveMotionInput): void {\n        const { id, lat, lng, speedKmh = 0, bearing, timestamp } = input;\n\n        let state = this.liveVehicles.get(id);\n        const now = timestamp || Date.now();\n        const speedMs = (speedKmh * 1000) / 3600;\n\n        // Determine if stopped based on explicit motion flag or speed\n        // Logic: if input.motion.moving is defined, use it. Otherwise fallback to speed.\n        let isStopped = false;\n        if (input.motion?.moving !== undefined) {\n            isStopped = !input.motion.moving;\n        } else {\n            isStopped = speedMs < 0.5;\n        }\n\n        // If ignition is explicitly off, force stop\n        if (input.motion?.ignition === 'off') {\n            isStopped = true;\n        }\n\n        if (!state) {\n            // Initialize new state\n            this.liveVehicles.set(id, {\n                realPosition: { lat, lon: lng, ts: now, speed: speedMs, bearing: bearing || 0 },\n                prevPosition: null,\n                virtualPosition: { lat, lon: lng, bearing: bearing || 0 },\n                targetBearing: bearing || 0,\n                isStopped\n            });\n            return;\n        }\n\n        // --- UPDATE EXISTING STATE ---\n\n        // Update real position references\n        state.prevPosition = {\n            lat: state.realPosition.lat,\n            lon: state.realPosition.lon,\n            ts: state.realPosition.ts\n        };\n\n        state.realPosition = {\n            lat,\n            lon: lng,\n            ts: now,\n            speed: speedMs,\n            bearing: bearing || state.realPosition.bearing\n        };\n\n        state.isStopped = isStopped;\n\n        // Update target bearing (Physical direction)\n        // If bearing provided, use it. If not, calculate from movement.\n        if (bearing !== undefined) {\n            state.targetBearing = bearing;\n        } else if (!isStopped && state.prevPosition) {\n            const dist = haversineDistance(\n                { lat: state.prevPosition.lat, lng: state.prevPosition.lon },\n                { lat, lng }\n            );\n            // Only update derived bearing if moved enough to be significant\n            if (dist > 2) {\n                state.targetBearing = computeBearing(state.prevPosition.lat, state.prevPosition.lon, lat, lng);\n            }\n        }\n\n        // Snap if too far (teleport detection)\n        const distVirtual = haversineDistance(\n            { lat: state.virtualPosition.lat, lng: state.virtualPosition.lon },\n            { lat, lng }\n        );\n\n        if (distVirtual > 500) {\n            state.virtualPosition.lat = lat;\n            state.virtualPosition.lon = lng;\n        }\n    }\n\n    remove(id: string | number): void {\n        this.liveVehicles.delete(id);\n    }\n\n    start(): void {\n        if (typeof window === 'undefined') return;\n        if (this.liveAnimationFrameId !== null) return;\n\n        const animate = (time: number) => {\n            if (!this.lastLiveFrameTime) this.lastLiveFrameTime = time;\n            const delta = time - this.lastLiveFrameTime;\n            this.lastLiveFrameTime = time;\n\n            const dt = Math.min(delta, 100) / 1000; // cap 100ms\n            const now = Date.now();\n\n            this.liveVehicles.forEach((state, id) => {\n                // Determine effective timestamp for age calculation\n                // We use state.realPosition.ts. If it's a backend TS, it might be slightly offset from Date.now()\n                // dependent on clock sync. Assuming reasonable sync or relative use.\n                const age = now - state.realPosition.ts;\n\n                // 1. Signal Loss Policy\n                if (age > this.policy.maxStaleMs) {\n                    state.isStopped = true;\n                }\n\n                if (state.isStopped) {\n                    // Decay virtual position to real last known position\n                    const nextPos = lerpPosition(\n                        state.virtualPosition,\n                        { lat: state.realPosition.lat, lon: state.realPosition.lon },\n                        0.1 // fast settlement\n                    );\n                    state.virtualPosition = { ...nextPos, bearing: state.virtualPosition.bearing };\n                } else {\n                    // 2. Prediction Window (Configurable Policy)\n                    let confidence = 0;\n                    if (age < this.policy.fullConfidenceMs) {\n                        confidence = 1;\n                    } else if (age < (this.policy.fullConfidenceMs + this.policy.decayMs)) {\n                        // Decay range\n                        const decayStart = this.policy.fullConfidenceMs;\n                        const decayEnd = decayStart + this.policy.decayMs;\n                        confidence = 1 - (age - decayStart) / (decayEnd - decayStart);\n                    } else {\n                        confidence = 0;\n                    }\n\n                    const effectiveSpeed = state.realPosition.speed * confidence;\n\n                    const projected = extrapolatePosition(\n                        state.virtualPosition.lat,\n                        state.virtualPosition.lon,\n                        effectiveSpeed,\n                        state.targetBearing,\n                        dt\n                    );\n\n                    // Pull towards real position to correct drift\n                    const nextVirtual = lerpPosition(\n                        projected,\n                        { lat: state.realPosition.lat, lon: state.realPosition.lon },\n                        0.05\n                    );\n                    state.virtualPosition = { ...nextVirtual, bearing: state.virtualPosition.bearing };\n\n                    // 3. Smooth Visual Rotation\n                    state.virtualPosition.bearing = lerpAngle(\n                        state.virtualPosition.bearing,\n                        state.targetBearing,\n                        0.15\n                    );\n                }\n\n                this.markerAdapter.setMarkerPosition(id, state.virtualPosition.lat, state.virtualPosition.lon);\n                this.markerAdapter.setMarkerRotation?.(id, state.virtualPosition.bearing);\n            });\n\n            this.liveAnimationFrameId = requestAnimationFrame(animate);\n        };\n\n        this.liveAnimationFrameId = requestAnimationFrame(animate);\n    }\n\n    stop(): void {\n        if (this.liveAnimationFrameId !== null) {\n            cancelAnimationFrame(this.liveAnimationFrameId);\n            this.liveAnimationFrameId = null;\n            this.lastLiveFrameTime = 0;\n        }\n    }\n\n    clear(): void {\n        this.liveVehicles.clear();\n    }\n}\n","/// <reference types=\"@types/google.maps\" />\nimport { haversineDistance } from '../../utils/geo.js';\n\n\ntype GoogleNamespace = typeof google;\n\nexport class TripReplayController {\n    private tripMarkers: google.maps.Marker[] = [];\n    private currentPolyline: google.maps.Polyline | null = null;\n    private vehicleMarker: google.maps.Marker | null = null;\n\n    // Data state\n    private coordinates: any[] = [];\n    private baseDuration = 0;\n\n    // Animation state\n    private animationFrameId: number | null = null;\n    private isPaused = false;\n    private animationStartTime = 0;\n    private pausedTime = 0;\n    private totalAnimationTime = 0;\n    private animationPath: any[] = [];\n    private onFinish: (() => void) | null = null;\n    private lastPauseTime = 0;\n\n    constructor(\n        private map: google.maps.Map,\n        private google: GoogleNamespace\n    ) { }\n\n    load(coordinates: any[]): void {\n        this.stop();\n        this.coordinates = coordinates || [];\n        this.drawPolyline(this.coordinates);\n\n        // Calculate base duration from timestamps if available\n        if (this.coordinates.length >= 2) {\n            const first = this.coordinates[0];\n            const last = this.coordinates[this.coordinates.length - 1];\n            if (first.ts && last.ts) {\n                this.baseDuration = Number(last.ts) - Number(first.ts);\n            } else if (first.timestamp && last.timestamp) { // Support alternative timestamp key\n                this.baseDuration = new Date(last.timestamp).getTime() - new Date(first.timestamp).getTime();\n            } else {\n                this.baseDuration = 10000; // Default 10s if no timestamps\n            }\n        }\n    }\n\n    drawPolyline(coordinates: any[]): void {\n        this.clearPolyline();\n\n        if (!coordinates || coordinates.length === 0) return;\n\n        const path: google.maps.LatLngLiteral[] = [];\n        const bounds = new this.google.maps.LatLngBounds();\n\n        coordinates.forEach(coord => {\n            const lat = Number(coord.lat);\n            const lng = Number(coord.lng || coord.lon);\n            if (!isNaN(lat) && !isNaN(lng)) {\n                const pos = { lat, lng };\n                path.push(pos);\n                bounds.extend(pos);\n\n                // Markers for alerts/ignition\n                if (coord.itemType === 'alert') {\n                    let iconUrl = null;\n                    if (coord.type === 'ignition_on') iconUrl = '/marker/marker-power-on.png';\n                    else if (coord.type === 'ignition_off') iconUrl = '/marker/marker-power-off.png';\n\n                    if (iconUrl) {\n                        const marker = new this.google.maps.Marker({\n                            position: pos,\n                            map: this.map,\n                            icon: {\n                                url: iconUrl,\n                                scaledSize: new this.google.maps.Size(32, 32),\n                                anchor: new this.google.maps.Point(16, 16)\n                            },\n                            title: coord.type\n                        });\n                        this.tripMarkers.push(marker);\n                    }\n                }\n            }\n        });\n\n        this.currentPolyline = new this.google.maps.Polyline({\n            path,\n            geodesic: true,\n            strokeColor: '#00FFFF',\n            strokeOpacity: 1.0,\n            strokeWeight: 4,\n            map: this.map\n        });\n\n        this.map.fitBounds(bounds);\n    }\n\n    play(options: { speed?: number, duration?: number } = {}, onFinish?: () => void): void {\n        if (!this.coordinates || this.coordinates.length < 2) return;\n\n        // If already playing or paused, stop first to restart unless it's a resume\n        // But user implies play starts from beginning or applies new options. \n        // Let's assume play() = restart with new options.\n        this.stop();\n\n        this.onFinish = onFinish || null;\n\n        // Determine total duration\n        let duration = options.duration;\n        if (!duration && options.speed) {\n            duration = this.baseDuration / options.speed;\n        }\n        if (!duration) duration = 10000; // Fallback\n\n        const rawPath = this.coordinates.map(c => ({\n            lat: Number(c.lat),\n            lng: Number(c.lng || c.lon)\n        })).filter(c => !isNaN(c.lat) && !isNaN(c.lng));\n\n        this.animationPath = this.prepareAnimationPath(rawPath, duration);\n        this.animationStartTime = performance.now();\n        this.pausedTime = 0;\n        this.isPaused = false;\n\n        // Create vehicle marker reuse logic\n        if (!this.vehicleMarker) {\n            this.vehicleMarker = new this.google.maps.Marker({\n                map: this.map,\n                icon: {\n                    url: 'https://cdn-icons-png.flaticon.com/512/3202/3202926.png',\n                    scaledSize: new this.google.maps.Size(40, 40),\n                    anchor: new this.google.maps.Point(20, 20)\n                },\n                zIndex: 1000\n            });\n        } else {\n            this.vehicleMarker.setMap(this.map);\n        }\n\n        if (this.animationPath.length > 0) {\n            const start = this.animationPath[0].type === 'move' ? this.animationPath[0].start : this.animationPath[0].position;\n            this.vehicleMarker?.setPosition(start);\n        }\n\n        this.startAnimationLoop();\n    }\n\n    private startAnimationLoop(): void {\n        const animate = (time: number) => {\n            if (this.isPaused) {\n                // Should not happen if we cancel RAF on pause, but safety check\n                return;\n            }\n\n            const elapsed = time - this.animationStartTime - this.pausedTime;\n            if (elapsed >= this.totalAnimationTime) {\n                const last = this.animationPath[this.animationPath.length - 1];\n                const end = last.type === 'move' ? last.end : last.position;\n                this.vehicleMarker?.setPosition(end);\n                this.isPaused = true;\n                this.onFinish?.();\n                return;\n            }\n\n            const segment = this.animationPath.find(s => elapsed >= s.startTime && elapsed < s.endTime);\n            if (segment && this.vehicleMarker) {\n                if (segment.type === 'stop') {\n                    this.vehicleMarker.setPosition(segment.position);\n                } else if (segment.type === 'move') {\n                    const segElapsed = elapsed - segment.startTime;\n                    const progress = segElapsed / segment.duration;\n                    const lat = segment.start.lat + (segment.end.lat - segment.start.lat) * progress;\n                    const lng = segment.start.lng + (segment.end.lng - segment.start.lng) * progress;\n                    this.vehicleMarker.setPosition({ lat, lng });\n\n                    // Update rotation if needed (not implemented in original but good to have)\n                    // if (segment.bearing) ...\n                }\n            }\n            this.animationFrameId = requestAnimationFrame(animate);\n        };\n        this.animationFrameId = requestAnimationFrame(animate);\n    }\n\n    stop(): void {\n        if (this.animationFrameId) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n        if (this.vehicleMarker) {\n            this.vehicleMarker.setMap(null);\n        }\n        this.isPaused = false;\n        this.pausedTime = 0;\n    }\n\n    pause(): void {\n        if (this.isPaused || !this.animationFrameId) return;\n        this.isPaused = true;\n        this.lastPauseTime = performance.now();\n        if (this.animationFrameId) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n    }\n\n    resume(): void {\n        if (!this.isPaused) return;\n        this.isPaused = false;\n        // Calculate how long we were paused\n        const now = performance.now();\n        const pauseDuration = now - this.lastPauseTime;\n        this.pausedTime += pauseDuration;\n\n        this.startAnimationLoop();\n    }\n\n    clearPolyline(): void {\n        if (this.currentPolyline) {\n            this.currentPolyline.setMap(null);\n            this.currentPolyline = null;\n        }\n        this.tripMarkers.forEach(m => m.setMap(null));\n        this.tripMarkers = [];\n        this.stop();\n    }\n\n    private prepareAnimationPath(rawPath: any[], totalDuration: number) {\n        const segments: any[] = [];\n        const STOP_THRESHOLD = 5;\n        const STOP_PAUSE_DURATION = 400;\n        let currentStop: any = null;\n\n        for (let i = 0; i < rawPath.length - 1; i++) {\n            const p1 = rawPath[i];\n            const p2 = rawPath[i + 1];\n            const dist = haversineDistance(p1, p2);\n\n            if (dist < STOP_THRESHOLD) {\n                if (!currentStop) {\n                    currentStop = { type: 'stop', position: p1, duration: STOP_PAUSE_DURATION };\n                    segments.push(currentStop);\n                }\n            } else {\n                currentStop = null;\n                segments.push({ type: 'move', start: p1, end: p2, distance: dist, duration: 0 });\n            }\n        }\n\n        const totalMoveDist = segments.filter(s => s.type === 'move').reduce((acc, s) => acc + s.distance, 0);\n        const totalStopDur = segments.filter(s => s.type === 'stop').reduce((acc, s) => acc + s.duration, 0);\n        const availableMoveTime = Math.max(1000, totalDuration - totalStopDur);\n\n        segments.forEach(s => {\n            if (s.type === 'move') {\n                s.duration = (s.distance / totalMoveDist) * availableMoveTime;\n            }\n        });\n\n        let accumulated = 0;\n        segments.forEach(s => {\n            s.startTime = accumulated;\n            accumulated += s.duration;\n            s.endTime = accumulated;\n        });\n\n        this.totalAnimationTime = accumulated;\n        return segments;\n    }\n}\n"],"mappings":"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","names":["google"]}